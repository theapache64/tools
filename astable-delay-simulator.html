<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astable Multivibrator Delay Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #ffffff;
            color: #000000;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }

        .container {
            max-width: 600px;
            width: 100%;
        }

        h1 {
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 600;
            font-size: 1.5rem;
        }

        .led-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 3rem;
        }

        .timer {
            margin-top: 1rem;
            font-size: 0.875rem;
            color: #666666;
            font-family: 'Courier New', monospace;
            text-align: center;
            min-height: 1.2rem;
        }

        .led {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #cccccc;
            border: 3px solid #999999;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            transition: all 0.1s ease;
            position: relative;
        }

        .led.on {
            background-color: #ffff00;
            border-color: #ffff00;
            box-shadow: 0 0 30px rgba(255, 255, 0, 0.8);
        }

        .controls {
            background-color: #f8f8f8;
            border: 1px solid #cccccc;
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .control-group {
            margin-bottom: 1.5rem;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .slider-container {
            position: relative;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .slider-wrapper {
            flex: 1;
        }

        .component-select {
            display: none; /* Hide dropdowns */
        }

        .value-display {
            width: 120px;
            padding: 0.5rem;
            border: 1px solid #cccccc;
            border-radius: 4px;
            font-size: 0.875rem;
            text-align: right;
            background-color: #f8f8f8;
            font-family: 'Courier New', monospace;
            color: #333333;
        }

        .value-display.disabled {
            background-color: #f5f5f5;
            color: #999999;
        }

        .number-input {
            display: none; /* Hide number inputs */
        }

        .number-input:focus {
            outline: none;
            border-color: #000000;
        }

        .number-input:disabled {
            background-color: #f5f5f5;
            color: #999999;
            cursor: not-allowed;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #cccccc;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            margin: 0.5rem 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #000000;
            cursor: pointer;
            border: 2px solid #ffffff;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #000000;
            cursor: pointer;
            border: 2px solid #ffffff;
        }

        input[type="range"]:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        input[type="range"]:disabled::-webkit-slider-thumb {
            background: #999999;
            cursor: not-allowed;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #000000;
            cursor: pointer;
            border: 2px solid #ffffff;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #000000;
            cursor: pointer;
            border: 2px solid #ffffff;
        }

        input[type="range"]:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        input[type="range"]:disabled::-webkit-slider-thumb {
            background: #999999;
            cursor: not-allowed;
        }

        .value-display {
            text-align: right;
            font-size: 0.875rem;
            color: #666666;
            margin-top: 0.25rem;
            display: block; /* Show value displays for better readability */
        }

        .delay-info {
            background-color: #f8f8f8;
            border: 1px solid #cccccc;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
        }

        .delay-value {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .delay-label {
            font-size: 0.875rem;
            color: #666666;
        }

        .status {
            margin-top: 1rem;
            padding: 0.75rem;
            background-color: #f0f0f0;
            border-radius: 6px;
            font-size: 0.875rem;
            text-align: center;
        }

        .disabled-label {
            color: #999999;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Astable Multivibrator Delay Simulator (AMDS)</h1>
        
        <div class="led-container">
            <div class="led" id="led"></div>
            <div class="timer" id="timer">Next blink in: --ms</div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="c1" class="disabled-label">C1 (Constant)</label>
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <input type="range" id="c1" min="0" max="0" value="0" disabled>
                    </div>
                    <div class="value-display disabled">1000µF</div>
                </div>
            </div>

            <div class="control-group">
                <label for="c2">C2</label>
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <input type="range" id="c2" min="0" max="31" value="16" step="1">
                    </div>
                    <div class="value-display" id="c2-value">22µF</div>
                </div>
            </div>

            <div class="control-group">
                <label for="r1" class="disabled-label">R1 (Constant)</label>
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <input type="range" id="r1" min="0" max="0" value="0" disabled>
                    </div>
                    <div class="value-display disabled">22Ω</div>
                </div>
            </div>

            <div class="control-group">
                <label for="r2">R2</label>
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <input type="range" id="r2" min="0" max="167" value="138" step="1">
                    </div>
                    <div class="value-display" id="r2-value">560kΩ</div>
                </div>
            </div>

            <div class="control-group">
                <label for="r3">R3</label>
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <input type="range" id="r3" min="0" max="167" value="72" step="1">
                    </div>
                    <div class="value-display" id="r3-value">1kΩ</div>
                </div>
            </div>

            <div class="control-group">
                <label for="r4">R4</label>
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <input type="range" id="r4" min="0" max="167" value="72" step="1">
                    </div>
                    <div class="value-display" id="r4-value">1kΩ</div>
                </div>
            </div>
        </div>

        <div class="delay-info">
            <div class="delay-value" id="delay-value">10000</div>
            <div class="delay-label">Calculated Delay (ms)</div>
            <div class="status" id="status">LED blinking with calculated delay</div>
        </div>
    </div>

    <script>
        // Standard component values
        const capacitorValues = [
            {display: "1µF", value: 1},
            {display: "1.2µF", value: 1.2},
            {display: "1.5µF", value: 1.5},
            {display: "1.8µF", value: 1.8},
            {display: "2.2µF", value: 2.2},
            {display: "2.7µF", value: 2.7},
            {display: "3.3µF", value: 3.3},
            {display: "3.9µF", value: 3.9},
            {display: "4.7µF", value: 4.7},
            {display: "5.6µF", value: 5.6},
            {display: "6.8µF", value: 6.8},
            {display: "8.2µF", value: 8.2},
            {display: "10µF", value: 10},
            {display: "12µF", value: 12},
            {display: "15µF", value: 15},
            {display: "18µF", value: 18},
            {display: "22µF", value: 22},
            {display: "27µF", value: 27},
            {display: "33µF", value: 33},
            {display: "39µF", value: 39},
            {display: "47µF", value: 47},
            {display: "56µF", value: 56},
            {display: "68µF", value: 68},
            {display: "82µF", value: 82},
            {display: "100µF", value: 100},
            {display: "220µF", value: 220},
            {display: "330µF", value: 330},
            {display: "470µF", value: 470},
            {display: "1000µF", value: 1000},
            {display: "2200µF", value: 2200},
            {display: "4700µF", value: 4700},
            {display: "10000µF", value: 10000}
        ];

        const resistorValues = [
            {display: "1Ω", value: 1}, {display: "1.1Ω", value: 1.1}, {display: "1.2Ω", value: 1.2}, {display: "1.3Ω", value: 1.3}, {display: "1.5Ω", value: 1.5}, {display: "1.6Ω", value: 1.6}, {display: "1.8Ω", value: 1.8}, {display: "2Ω", value: 2}, {display: "2.2Ω", value: 2.2}, {display: "2.4Ω", value: 2.4}, {display: "2.7Ω", value: 2.7}, {display: "3Ω", value: 3}, {display: "3.3Ω", value: 3.3}, {display: "3.6Ω", value: 3.6}, {display: "3.9Ω", value: 3.9}, {display: "4.3Ω", value: 4.3}, {display: "4.7Ω", value: 4.7}, {display: "5.1Ω", value: 5.1}, {display: "5.6Ω", value: 5.6}, {display: "6.2Ω", value: 6.2}, {display: "6.8Ω", value: 6.8}, {display: "7.5Ω", value: 7.5}, {display: "8.2Ω", value: 8.2}, {display: "9.1Ω", value: 9.1},
            {display: "10Ω", value: 10}, {display: "11Ω", value: 11}, {display: "12Ω", value: 12}, {display: "13Ω", value: 13}, {display: "15Ω", value: 15}, {display: "16Ω", value: 16}, {display: "18Ω", value: 18}, {display: "20Ω", value: 20}, {display: "22Ω", value: 22}, {display: "24Ω", value: 24}, {display: "27Ω", value: 27}, {display: "30Ω", value: 30}, {display: "33Ω", value: 33}, {display: "36Ω", value: 36}, {display: "39Ω", value: 39}, {display: "43Ω", value: 43}, {display: "47Ω", value: 47}, {display: "51Ω", value: 51}, {display: "56Ω", value: 56}, {display: "62Ω", value: 62}, {display: "68Ω", value: 68}, {display: "75Ω", value: 75}, {display: "82Ω", value: 82}, {display: "91Ω", value: 91},
            {display: "100Ω", value: 100}, {display: "110Ω", value: 110}, {display: "120Ω", value: 120}, {display: "130Ω", value: 130}, {display: "150Ω", value: 150}, {display: "160Ω", value: 160}, {display: "180Ω", value: 180}, {display: "200Ω", value: 200}, {display: "220Ω", value: 220}, {display: "240Ω", value: 240}, {display: "270Ω", value: 270}, {display: "300Ω", value: 300}, {display: "330Ω", value: 330}, {display: "360Ω", value: 360}, {display: "390Ω", value: 390}, {display: "430Ω", value: 430}, {display: "470Ω", value: 470}, {display: "510Ω", value: 510}, {display: "560Ω", value: 560}, {display: "620Ω", value: 620}, {display: "680Ω", value: 680}, {display: "750Ω", value: 750}, {display: "820Ω", value: 820}, {display: "910Ω", value: 910},
            {display: "1kΩ", value: 1000}, {display: "1.1kΩ", value: 1100}, {display: "1.2kΩ", value: 1200}, {display: "1.3kΩ", value: 1300}, {display: "1.5kΩ", value: 1500}, {display: "1.6kΩ", value: 1600}, {display: "1.8kΩ", value: 1800}, {display: "2kΩ", value: 2000}, {display: "2.2kΩ", value: 2200}, {display: "2.4kΩ", value: 2400}, {display: "2.7kΩ", value: 2700}, {display: "3kΩ", value: 3000}, {display: "3.3kΩ", value: 3300}, {display: "3.6kΩ", value: 3600}, {display: "3.9kΩ", value: 3900}, {display: "4.3kΩ", value: 4300}, {display: "4.7kΩ", value: 4700}, {display: "5.1kΩ", value: 5100}, {display: "5.6kΩ", value: 5600}, {display: "6.2kΩ", value: 6200}, {display: "6.8kΩ", value: 6800}, {display: "7.5kΩ", value: 7500}, {display: "8.2kΩ", value: 8200}, {display: "9.1kΩ", value: 9100},
            {display: "10kΩ", value: 10000}, {display: "11kΩ", value: 11000}, {display: "12kΩ", value: 12000}, {display: "13kΩ", value: 13000}, {display: "15kΩ", value: 15000}, {display: "16kΩ", value: 16000}, {display: "18kΩ", value: 18000}, {display: "20kΩ", value: 20000}, {display: "22kΩ", value: 22000}, {display: "24kΩ", value: 24000}, {display: "27kΩ", value: 27000}, {display: "30kΩ", value: 30000}, {display: "33kΩ", value: 33000}, {display: "36kΩ", value: 36000}, {display: "39kΩ", value: 39000}, {display: "43kΩ", value: 43000}, {display: "47kΩ", value: 47000}, {display: "51kΩ", value: 51000}, {display: "56kΩ", value: 56000}, {display: "62kΩ", value: 62000}, {display: "68kΩ", value: 68000}, {display: "75kΩ", value: 75000}, {display: "82kΩ", value: 82000}, {display: "91kΩ", value: 91000},
            {display: "100kΩ", value: 100000}, {display: "110kΩ", value: 110000}, {display: "120kΩ", value: 120000}, {display: "130kΩ", value: 130000}, {display: "150kΩ", value: 150000}, {display: "160kΩ", value: 160000}, {display: "180kΩ", value: 180000}, {display: "200kΩ", value: 200000}, {display: "220kΩ", value: 220000}, {display: "240kΩ", value: 240000}, {display: "270kΩ", value: 270000}, {display: "300kΩ", value: 300000}, {display: "330kΩ", value: 330000}, {display: "360kΩ", value: 360000}, {display: "390kΩ", value: 390000}, {display: "430kΩ", value: 430000}, {display: "470kΩ", value: 470000}, {display: "510kΩ", value: 510000}, {display: "560kΩ", value: 560000}, {display: "620kΩ", value: 620000}, {display: "680kΩ", value: 680000}, {display: "750kΩ", value: 750000}, {display: "820kΩ", value: 820000}, {display: "910kΩ", value: 910000},
            {display: "1MΩ", value: 1000000}, {display: "1.1MΩ", value: 1100000}, {display: "1.2MΩ", value: 1200000}, {display: "1.3MΩ", value: 1300000}, {display: "1.5MΩ", value: 1500000}, {display: "1.6MΩ", value: 1600000}, {display: "1.8MΩ", value: 1800000}, {display: "2MΩ", value: 2000000}, {display: "2.2MΩ", value: 2200000}, {display: "2.4MΩ", value: 2400000}, {display: "2.7MΩ", value: 2700000}, {display: "3MΩ", value: 3000000}, {display: "3.3MΩ", value: 3300000}, {display: "3.6MΩ", value: 3600000}, {display: "3.9MΩ", value: 3900000}, {display: "4.3MΩ", value: 4300000}, {display: "4.7MΩ", value: 4700000}, {display: "5.1MΩ", value: 5100000}, {display: "5.6MΩ", value: 5600000}, {display: "6.2MΩ", value: 6200000}, {display: "6.8MΩ", value: 6800000}, {display: "7.5MΩ", value: 7500000}, {display: "8.2MΩ", value: 8200000}, {display: "9.1MΩ", value: 9100000}, {display: "10MΩ", value: 10000000}
        ];

        // Training data from CSV
        const trainingData = [
            {c1: 1000, c2: 47, r1: 22, r2: 560000, r3: 1000, r4: 1000, delay: 10000},
            {c1: 1000, c2: 22, r1: 22, r2: 560000, r3: 1000, r4: 1000, delay: 4679},
            {c1: 1000, c2: 10, r1: 22, r2: 560000, r3: 1000, r4: 1000, delay: 2036},
            {c1: 1000, c2: 22, r1: 22, r2: 510000, r3: 1000, r4: 1000, delay: 4848},
            {c1: 1000, c2: 22, r1: 22, r2: 220000, r3: 1000, r4: 1000, delay: 2191},
            {c1: 1000, c2: 22, r1: 22, r2: 91000, r3: 1000, r4: 1000, delay: 947},
            {c1: 1000, c2: 47, r1: 22, r2: 560000, r3: 2200, r4: 2200, delay: 3742},
            {c1: 1000, c2: 47, r1: 22, r2: 560000, r3: 2200, r4: 1000, delay: 5051},
            {c1: 1000, c2: 100, r1: 22, r2: 560000, r3: 1000, r4: 1000, delay: 22234},
            {c1: 1000, c2: 100, r1: 22, r2: 560000, r3: 100000, r4: 1000, delay: 23731}
        ];

        const led = document.getElementById('led');
        const timer = document.getElementById('timer');
        const delayDisplay = document.getElementById('delay-value');
        const statusDisplay = document.getElementById('status');
        
        const c2Slider = document.getElementById('c2');
        const r2Slider = document.getElementById('r2');
        const r3Slider = document.getElementById('r3');
        const r4Slider = document.getElementById('r4');
        
        const c2Value = document.getElementById('c2-value');
        const r2Value = document.getElementById('r2-value');
        const r3Value = document.getElementById('r3-value');
        const r4Value = document.getElementById('r4-value');

        let blinkInterval;
        let countdownInterval;
        let nextBlinkTime;

        // Function to get component value from slider index
        function getCapacitorValue(index) {
            return capacitorValues[index] || capacitorValues[0];
        }

        function getResistorValue(index) {
            return resistorValues[index] || resistorValues[0];
        }

        // Function to update displays with proper units
        function updateDisplays() {
            const c2Cap = getCapacitorValue(parseInt(c2Slider.value));
            const r2Res = getResistorValue(parseInt(r2Slider.value));
            const r3Res = getResistorValue(parseInt(r3Slider.value));
            const r4Res = getResistorValue(parseInt(r4Slider.value));
            
            c2Value.textContent = c2Cap.display;
            r2Value.textContent = r2Res.display;
            r3Value.textContent = r3Res.display;
            r4Value.textContent = r4Res.display;
        }

        function updateDelay() {
            const c2Cap = getCapacitorValue(parseInt(c2Slider.value));
            const r2Res = getResistorValue(parseInt(r2Slider.value));
            const r3Res = getResistorValue(parseInt(r3Slider.value));
            const r4Res = getResistorValue(parseInt(r4Slider.value));
            
            const delay = calculateDelay(c2Cap.value, r2Res.value, r3Res.value, r4Res.value);
            
            delayDisplay.textContent = delay;
            statusDisplay.textContent = `LED blinking every ${delay}ms`;
            
            // Restart blinking with new delay
            startBlinking(delay);
        }

        // Calculate delay using interpolation/approximation based on training data
        function calculateDelay(c2, r2, r3, r4) {
            // Handle edge cases for zero values
            if (c2 === 0) c2 = 1; // Avoid division by zero
            if (r2 === 0) r2 = 1;
            if (r3 === 0) r3 = 1;
            if (r4 === 0) r4 = 1;

            // Find the closest matches in training data
            let bestMatch = trainingData[0];
            let minDistance = Infinity;

            // Calculate weighted distance to find best match
            trainingData.forEach(data => {
                const distance = 
                    Math.abs(data.c2 - c2) * 0.001 +
                    Math.abs(data.r2 - r2) * 0.000001 +
                    Math.abs(data.r3 - r3) * 0.001 +
                    Math.abs(data.r4 - r4) * 0.001;
                
                if (distance < minDistance) {
                    minDistance = distance;
                    bestMatch = data;
                }
            });

            // Base delay calculation with enhanced logic for wider ranges
            let delay = bestMatch.delay;
            
            // C2 effect: logarithmic relationship for wider range
            const c2Ratio = c2 / bestMatch.c2;
            if (c2Ratio !== 1) {
                delay *= Math.pow(c2Ratio, 0.8);
            }
            
            // R2 effect: square root relationship for very large range
            const r2Ratio = r2 / bestMatch.r2;
            if (r2Ratio !== 1) {
                delay *= Math.pow(r2Ratio, 0.2);
            }
            
            // R3 and R4 effect: inverse relationship with damping for large values
            const r3Ratio = r3 / bestMatch.r3;
            const r4Ratio = r4 / bestMatch.r4;
            const avgRRatio = (r3Ratio + r4Ratio) / 2;
            
            if (avgRRatio > 1) {
                // Higher resistance values reduce delay
                delay /= Math.pow(avgRRatio, 0.3);
            } else if (avgRRatio < 1) {
                // Lower resistance values increase delay
                delay *= Math.pow(1 / avgRRatio, 0.2);
            }
            
            // Apply scaling factor for the extended ranges
            const scalingFactor = 1 + (c2 / 1000) * 0.5; // Scale based on C2 range
            delay *= scalingFactor;
            
            return Math.max(50, Math.round(delay)); // Minimum 50ms delay
        }

        function startBlinking(delay) {
            // Clear existing intervals
            if (blinkInterval) {
                clearInterval(blinkInterval);
            }
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            // Set the initial next blink time
            nextBlinkTime = Date.now() + delay;
            
            // Start countdown timer (updates every 10ms for smooth animation)
            countdownInterval = setInterval(() => {
                const remaining = Math.max(0, nextBlinkTime - Date.now());
                timer.textContent = `Next blink in: ${remaining}ms`;
            }, 10);
            
            // Start new blinking pattern
            blinkInterval = setInterval(() => {
                led.classList.add('on');
                setTimeout(() => {
                    led.classList.remove('on');
                }, 100); // LED stays on for 100ms
                
                // Update next blink time
                nextBlinkTime = Date.now() + delay;
            }, delay);
        }

        // Event listeners for sliders
        c2Slider.addEventListener('input', () => {
            updateDisplays();
            updateDelay();
        });

        r2Slider.addEventListener('input', () => {
            updateDisplays();
            updateDelay();
        });

        r3Slider.addEventListener('input', () => {
            updateDisplays();
            updateDelay();
        });

        r4Slider.addEventListener('input', () => {
            updateDisplays();
            updateDelay();
        });

        // Initialize
        updateDisplays();
        updateDelay();
    </script>
</body>
</html>