<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battery Life Calculator</title>
    <style>
        /* Neo Brutalist Design System */
        :root {
            --background: #ffffff;
            --foreground: #000000;
            --primary: #ff3e41;
            --secondary: #3633ff;
            --accent: #ffde59;
            --neutral: #e0e0e0;
            --border-width: 3px;
            --shadow-offset: 6px;
            --box-shadow: 6px 6px 0 0 #000000;
            --border-radius: 2px;
            --font-family: 'Courier New', monospace;
        }

        .dark {
            --background: #0f0f0f;
            --foreground: #ffffff;
            --primary: #ff5e54;
            --secondary: #4d4aff;
            --accent: #ffe066;
            --neutral: #333333;
            --box-shadow: 6px 6px 0 0 #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--background);
            color: var(--foreground);
            font-family: var(--font-family);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--background);
            border: var(--border-width) solid var(--foreground);
            box-shadow: var(--box-shadow);
            overflow: visible;
        }

        .header {
            background: var(--primary);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: var(--border-width) solid var(--foreground);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: -1px;
        }

        .header p {
            font-size: 1.1rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .content {
            padding: 40px;
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .input-column {
            flex: 1;
            min-width: 400px;
        }

        .output-column {
            flex: 1;
            min-width: 400px;
        }

        .input-section {
            margin-bottom: 30px;
            background: var(--background);
            border: var(--border-width) solid var(--foreground);
            box-shadow: var(--box-shadow);
            padding: 25px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .input-section:hover {
            transform: translate(-2px, -2px);
            box-shadow: calc(var(--shadow-offset) + 2px) calc(var(--shadow-offset) + 2px) 0 0 var(--foreground);
        }

        .section-title {
            font-size: 1.4rem;
            color: var(--foreground);
            margin-bottom: 20px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: -1px;
            border-bottom: var(--border-width) solid var(--foreground);
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: flex-end;
        }

        .input-row.single {
            flex-direction: column;
            align-items: stretch;
        }

        .input-field {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 800;
            color: var(--foreground);
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: var(--border-width) solid var(--foreground);
            border-radius: var(--border-radius);
            font-size: 1rem;
            background: var(--background);
            color: var(--foreground);
            font-family: var(--font-family);
            font-weight: bold;
            transition: all 0.2s ease;
        }

        input:focus, select:focus {
            outline: none;
            box-shadow: 4px 4px 0 0 var(--foreground);
            transform: translate(-2px, -2px);
        }

        input:read-only {
            background: var(--neutral);
            color: var(--foreground);
            opacity: 0.8;
        }

        .help-text {
            font-size: 0.85rem;
            color: var(--foreground);
            margin-top: 5px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .battery-info {
            background: var(--neutral);
            padding: 15px;
            border: var(--border-width) solid var(--foreground);
            margin-top: 10px;
        }

        .calculations {
            background: var(--secondary);
            color: white;
            padding: 30px;
            border: var(--border-width) solid var(--foreground);
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .calculations:hover {
            transform: translate(-2px, -2px);
            box-shadow: calc(var(--shadow-offset) + 2px) calc(var(--shadow-offset) + 2px) 0 0 var(--foreground);
        }

        .calculations h3 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: -1px;
        }

        .calc-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .calc-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border: var(--border-width) solid white;
            text-align: center;
            transition: all 0.2s ease;
        }

        .calc-item:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-1px, -1px);
            box-shadow: 2px 2px 0 0 white;
        }

        .calc-label {
            font-size: 0.85rem;
            margin-bottom: 5px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .calc-value {
            font-size: 1.4rem;
            font-weight: 800;
        }

        .result {
            background: var(--accent);
            color: var(--foreground);
            padding: 30px;
            border: var(--border-width) solid var(--foreground);
            box-shadow: var(--box-shadow);
            text-align: center;
            margin-bottom: 30px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .result:hover {
            transform: translate(-2px, -2px);
            box-shadow: calc(var(--shadow-offset) + 2px) calc(var(--shadow-offset) + 2px) 0 0 var(--foreground);
        }

        .result h3 {
            font-size: 2rem;
            margin-bottom: 15px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: -1px;
        }

        .result-main {
            font-size: 1.4rem;
            margin-bottom: 20px;
            line-height: 1.5;
            font-weight: bold;
        }

        .result-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .result-item {
            background: rgba(0, 0, 0, 0.1);
            padding: 15px;
            border: var(--border-width) solid var(--foreground);
            transition: all 0.2s ease;
        }

        .result-item:hover {
            background: rgba(0, 0, 0, 0.2);
            transform: translate(-1px, -1px);
            box-shadow: 2px 2px 0 0 var(--foreground);
        }

        .result-number {
            font-size: 1.6rem;
            font-weight: 800;
            display: block;
            color: var(--foreground);
        }

        .result-unit {
            font-size: 0.9rem;
            font-weight: bold;
            text-transform: uppercase;
            color: var(--foreground);
        }

        .reset-btn {
            background: var(--primary);
            color: white;
            border: var(--border-width) solid var(--foreground);
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 800;
            text-transform: uppercase;
            cursor: pointer;
            font-family: var(--font-family);
            box-shadow: var(--box-shadow);
            transition: all 0.2s ease;
            width: 100%;
        }

        .reset-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: calc(var(--shadow-offset) + 2px) calc(var(--shadow-offset) + 2px) 0 0 var(--foreground);
        }

        .reset-btn:active {
            transform: translate(0, 0);
            box-shadow: 2px 2px 0 0 var(--foreground);
        }

        .warning {
            background: var(--accent);
            color: var(--foreground);
            padding: 10px 15px;
            border: var(--border-width) solid var(--foreground);
            margin-top: 10px;
            font-size: 0.9rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        @media (max-width: 1024px) {
            .content {
                flex-direction: column;
                gap: 20px;
            }

            .input-column, .output-column {
                min-width: auto;
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .calc-grid {
                grid-template-columns: 1fr;
            }
            
            .result-breakdown {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 2rem;
            }

            .container {
                margin: 10px;
            }

            body {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîã Battery Life Calculator</h1>
            <p>Calculate how long your circuit will run on any battery type</p>
        </div>

        <div class="content">
            <!-- Left Column - Inputs -->
            <div class="input-column">
                <!-- Battery Selection -->
                <div class="input-section">
                    <h3 class="section-title">Battery Selection</h3>
                    <div class="input-group">
                        <div class="input-row single">
                            <div class="input-field">
                                <label for="batteryBrand">Battery Brand/Type:</label>
                                <select id="batteryBrand">
                                    <optgroup label="AA Batteries">
                                        <option value="duracell-ultra-aa">Duracell Ultra AA (2,800mAh, 1.5V)</option>
                                        <option value="duracell-coppertop-aa">Duracell CopperTop AA (2,500mAh, 1.5V)</option>
                                        <option value="energizer-max-aa">Energizer Max AA (2,850mAh, 1.5V)</option>
                                        <option value="energizer-ultimate-aa">Energizer Ultimate Lithium AA (3,500mAh, 1.5V)</option>
                                        <option value="eveready-aa">Eveready AA (2,100mAh, 1.5V)</option>
                                        <option value="kirkland-aa">Kirkland Signature AA (2,400mAh, 1.5V)</option>
                                        <option value="rayovac-aa">Rayovac AA (2,200mAh, 1.5V)</option>
                                    </optgroup>
                                    <optgroup label="AAA Batteries">
                                        <option value="duracell-aaa">Duracell AAA (1,000mAh, 1.5V)</option>
                                        <option value="energizer-aaa">Energizer AAA (1,200mAh, 1.5V)</option>
                                    </optgroup>
                                    <optgroup label="9V Batteries">
                                        <option value="duracell-9v">Duracell 9V (550mAh, 9.0V)</option>
                                        <option value="energizer-9v">Energizer 9V (625mAh, 9.0V)</option>
                                        <option value="eveready-9v">Eveready 9V (500mAh, 9.0V)</option>
                                    </optgroup>
                                    <optgroup label="Specialty Batteries">
                                        <option value="cr2032">CR2032 Coin Cell (240mAh, 3.0V)</option>
                                        <option value="cr123a">CR123A Lithium (1,500mAh, 3.0V)</option>
                                    </optgroup>
                                    <optgroup label="Custom">
                                        <option value="custom">Custom (Enter manually)</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-field">
                                <label for="batteryCapacity">Battery Capacity (mAh):</label>
                                <input type="number" id="batteryCapacity" value="2800" min="1" step="1">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-field">
                                <label for="batteryVoltage">Battery Voltage (V):</label>
                                <input type="number" id="batteryVoltage" value="1.5" step="0.1" min="0.1">
                                <div class="help-text">Battery voltage affects power calculations</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Current Input -->
                <div class="input-section">
                    <h3 class="section-title">Current Consumption</h3>
                    <div class="input-group">
                        <div class="input-row">
                            <div class="input-field">
                                <label for="currentDraw">Current Draw (mA):</label>
                                <input type="number" id="currentDraw" value="0.7" min="0.001" step="0.001">
                                <div class="help-text">Enter the current drawn when the circuit is ON</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pulse Timing -->
                <div class="input-section">
                    <h3 class="section-title">Pulse Timing</h3>
                    <div class="input-group">
                        <div class="input-row">
                            <div class="input-field">
                                <label for="pulseInterval">Interval (seconds):</label>
                                <input type="number" id="pulseInterval" value="5" min="0.001" step="0.001">
                                <div class="help-text">How often the current pulse occurs</div>
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="input-field">
                                <label for="pulseDuration">Pulse Duration (seconds):</label>
                                <input type="number" id="pulseDuration" value="0.1" min="0.001" step="0.001">
                                <div class="help-text">How long each current pulse lasts</div>
                            </div>
                        </div>
                        <div class="help-text">
                            <strong>Example:</strong> A sensor that draws 0.7mA for 0.1 seconds every 5 seconds
                        </div>
                        <div id="pulseWarning" class="warning" style="display: none;">
                            ‚ö†Ô∏è Pulse duration cannot be longer than the interval
                        </div>
                    </div>
                </div>

                <!-- Operation Mode -->
                <div class="input-section">
                    <h3 class="section-title">Operation Mode</h3>
                    <div class="input-group">
                        <div class="input-row single">
                            <div class="input-field">
                                <label>
                                    <input type="checkbox" id="dayModeToggle" style="margin-right: 0.5rem;">
                                    12-hour operation (day only)
                                </label>
                                <div class="help-text">Enable for circuits that only operate during daylight hours</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reset Button -->
                <button class="reset-btn" onclick="resetToDefaults()">üîÑ Reset to Defaults</button>
            </div>

            <!-- Right Column - Outputs -->
            <div class="output-column">
                <!-- Calculations Display -->
                <div class="calculations">
                    <h3>üìä Calculations</h3>
                    <div class="calc-grid">
                        <div class="calc-item">
                            <div class="calc-label">Duty Cycle</div>
                            <div class="calc-value" id="dutyCycle">2.0%</div>
                        </div>
                        <div class="calc-item">
                            <div class="calc-label">LED Current</div>
                            <div class="calc-value" id="avgLedCurrent">0.014 mA</div>
                        </div>
                        <div class="calc-item">
                            <div class="calc-label">Quiescent Current</div>
                            <div class="calc-value" id="quiescentCurrent">0.5 mA</div>
                        </div>
                        <div class="calc-item">
                            <div class="calc-label">Total Current</div>
                            <div class="calc-value" id="totalCurrent">0.514 mA</div>
                        </div>
                        <div class="calc-item">
                            <div class="calc-label">Effective Average</div>
                            <div class="calc-value" id="effectiveCurrent">0.257 mA</div>
                        </div>
                        <div class="calc-item">
                            <div class="calc-label">Battery Life</div>
                            <div class="calc-value" id="batteryLifeHours">10,894 hours</div>
                        </div>
                    </div>
                </div>

                <!-- Results -->
                <div class="result">
                    <h3>‚è±Ô∏è Battery Life Results</h3>
                    <div class="result-main" id="resultMain">
                        Your circuit will run for <strong>7.99 years</strong> on a single Duracell Ultra AA battery.
                    </div>
                    <div class="result-breakdown">
                        <div class="result-item">
                            <span class="result-number" id="resultYears">7.99</span>
                            <span class="result-unit">Years</span>
                        </div>
                        <div class="result-item">
                            <span class="result-number" id="resultMonths">95.9</span>
                            <span class="result-unit">Months</span>
                        </div>
                        <div class="result-item">
                            <span class="result-number" id="resultDays">2,917</span>
                            <span class="result-unit">Days</span>
                        </div>
                        <div class="result-item">
                            <span class="result-number" id="resultHours">70,000</span>
                            <span class="result-unit">Hours</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Battery configurations
        const batteryConfigs = {
            'duracell-ultra-aa': { name: 'Duracell Ultra AA', capacity: 1500, voltage: 1.5 },
            'eveready-aa': { name: 'Eveready AA', capacity: 540, voltage: 1.5 },
            'custom': { name: 'Custom', capacity: 1500, voltage: 1.5 }
        };

        // Get DOM elements
        const batteryBrand = document.getElementById('batteryBrand');
        const batteryCapacity = document.getElementById('batteryCapacity');
        const batteryVoltage = document.getElementById('batteryVoltage');
        const currentDraw = document.getElementById('currentDraw');
        const pulseInterval = document.getElementById('pulseInterval');
        const pulseDuration = document.getElementById('pulseDuration');
        const pulseWarning = document.getElementById('pulseWarning');
        const dayModeToggle = document.getElementById('dayModeToggle');

        // Result elements
        const dutyCycle = document.getElementById('dutyCycle');
        const avgLedCurrent = document.getElementById('avgLedCurrent');
        const quiescentCurrent = document.getElementById('quiescentCurrent');
        const totalCurrent = document.getElementById('totalCurrent');
        const effectiveCurrent = document.getElementById('effectiveCurrent');
        const batteryLifeHours = document.getElementById('batteryLifeHours');
        const resultMain = document.getElementById('resultMain');
        const resultYears = document.getElementById('resultYears');
        const resultMonths = document.getElementById('resultMonths');
        const resultDays = document.getElementById('resultDays');
        const resultHours = document.getElementById('resultHours');

        // Event listeners
        batteryBrand.addEventListener('change', onBatteryBrandChange);
        batteryCapacity.addEventListener('input', calculateBatteryLife);
        batteryVoltage.addEventListener('input', calculateBatteryLife);
        currentDraw.addEventListener('input', validateAndCalculate);
        pulseInterval.addEventListener('input', validateAndCalculate);
        pulseDuration.addEventListener('input', validateAndCalculate);
        dayModeToggle.addEventListener('change', calculateBatteryLife);

        function onBatteryBrandChange() {
            const selectedBrand = batteryBrand.value;
            const config = batteryConfigs[selectedBrand];
            
            if (selectedBrand !== 'custom') {
                batteryCapacity.value = config.capacity;
                batteryVoltage.value = config.voltage;
                batteryCapacity.readOnly = true;
                batteryVoltage.readOnly = true;
            } else {
                batteryCapacity.readOnly = false;
                batteryVoltage.readOnly = false;
                batteryCapacity.focus();
            }
            
            calculateBatteryLife();
        }

        function validateAndCalculate() {
            // Validate inputs
            const current = parseFloat(currentDraw.value);
            const interval = parseFloat(pulseInterval.value);
            const duration = parseFloat(pulseDuration.value);

            // Check if current is valid
            if (current <= 0) {
                currentDraw.setCustomValidity('Current must be greater than 0');
            } else {
                currentDraw.setCustomValidity('');
            }

            // Check if pulse duration is not longer than interval
            if (duration > interval) {
                pulseWarning.style.display = 'block';
                pulseDuration.style.borderColor = 'var(--primary)';
                pulseDuration.style.borderWidth = 'var(--border-width)';
            } else {
                pulseWarning.style.display = 'none';
                pulseDuration.style.borderColor = 'var(--foreground)';
                pulseDuration.style.borderWidth = 'var(--border-width)';
            }

            calculateBatteryLife();
        }

        function calculateBatteryLife() {
            try {
                // Get input values
                const capacity = parseFloat(batteryCapacity.value);
                const voltage = parseFloat(batteryVoltage.value);
                const ledCurrentMa = parseFloat(currentDraw.value);
                const interval = parseFloat(pulseInterval.value);
                const duration = parseFloat(pulseDuration.value);
                const isDayMode = dayModeToggle.checked;

                // Validate inputs
                if (isNaN(capacity) || isNaN(voltage) || isNaN(ledCurrentMa) || isNaN(interval) || isNaN(duration) ||
                    capacity <= 0 || voltage <= 0 || ledCurrentMa <= 0 || interval <= 0 || duration <= 0) {
                    return;
                }

                if (duration > interval) {
                    return;
                }

                // Circuit specifications (matching astable delay simulator)
                const quiescentCurrentMa = 0.5; // Circuit's quiescent current
                
                // Calculate duty cycle correctly: LED on time / total cycle time
                const dutyCycleValue = duration / interval;
                const dutyCyclePercent = dutyCycleValue * 100;
                
                // Calculate average LED current using proper duty cycle formula
                const avgLedCurrentMa = ledCurrentMa * dutyCycleValue;
                const totalCurrentMa = quiescentCurrentMa + avgLedCurrentMa;
                
                // Apply day mode factor to operating hours (not to current)
                const operatingHoursPerDay = isDayMode ? 12 : 24;
                const operatingDutyCycle = operatingHoursPerDay / 24;
                
                // Calculate effective average current over 24 hours
                const effectiveAvgCurrentMa = totalCurrentMa * operatingDutyCycle;
                
                // Calculate battery life using correct formula: capacity / average_current
                const batteryLifeHoursValue = capacity / effectiveAvgCurrentMa;

                // Convert to other time units with proper decimals
                const days = batteryLifeHoursValue / 24;
                const months = days / 30;
                const years = days / 365;

                // Update display elements
                dutyCycle.textContent = `${dutyCyclePercent.toFixed(2)}%`;
                avgLedCurrent.textContent = `${avgLedCurrentMa.toFixed(3)} mA`;
                quiescentCurrent.textContent = `${quiescentCurrentMa.toFixed(1)} mA`;
                totalCurrent.textContent = `${totalCurrentMa.toFixed(3)} mA`;
                effectiveCurrent.textContent = `${effectiveAvgCurrentMa.toFixed(3)} mA`;
                batteryLifeHours.textContent = `${Math.round(batteryLifeHoursValue).toLocaleString()} hours`;

                // Update result breakdown
                resultYears.textContent = years.toFixed(2);
                resultMonths.textContent = months.toFixed(1);
                resultDays.textContent = Math.round(days).toLocaleString();
                resultHours.textContent = Math.round(batteryLifeHoursValue).toLocaleString();

                // Update main result text
                const selectedBrand = batteryBrand.value;
                const brandName = batteryConfigs[selectedBrand].name;
                
                let timeDisplay;
                if (years >= 1) {
                    timeDisplay = `${years.toFixed(2)} years`;
                } else if (months >= 1) {
                    timeDisplay = `${months.toFixed(1)} months`;
                } else if (days >= 1) {
                    timeDisplay = `${Math.round(days)} days`;
                } else {
                    timeDisplay = `${Math.round(batteryLifeHoursValue)} hours`;
                }

                const operationMode = isDayMode ? " (12-hour operation)" : " (24-hour operation)";
                resultMain.innerHTML = `Your circuit will run for <strong>${timeDisplay}</strong> on a single ${brandName} battery${operationMode}.`;

            } catch (error) {
                console.error('Calculation error:', error);
            }
        }

        function resetToDefaults() {
            batteryBrand.value = 'duracell-ultra-aa';
            currentDraw.value = '0.7';
            pulseInterval.value = '5';
            pulseDuration.value = '0.1';
            dayModeToggle.checked = false;
            onBatteryBrandChange();
        }

        // Populate battery dropdown and initialize
        function initializePage() {
            // Populate battery dropdown
            batteryBrand.innerHTML = '';
            
            // Add optgroups
            const aaGroup = document.createElement('optgroup');
            aaGroup.label = 'AA Batteries';
            aaGroup.innerHTML = `
                <option value="duracell-ultra-aa">Duracell Ultra AA (1,500mAh, 1.5V)</option>
                <option value="eveready-aa">Eveready AA (540mAh, 1.5V)</option>
            `;
            
            const customGroup = document.createElement('optgroup');
            customGroup.label = 'Custom';
            customGroup.innerHTML = `
                <option value="custom">Custom (Enter manually)</option>
            `;
            
            batteryBrand.appendChild(aaGroup);
            batteryBrand.appendChild(customGroup);
            
            // Set default selection
            batteryBrand.value = 'duracell-ultra-aa';
            onBatteryBrandChange();
            calculateBatteryLife();
        }

        // Initial calculation
        initializePage();
    </script>
</body>
</html>